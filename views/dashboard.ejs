<%- include('partials/header', { title: 'Dashboard - SecureGuard' }) %> <%-
include('partials/sidebar', { page: 'dashboard' }) %>

<div class="main-content">
  <div class="container">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3rem;
      "
    >
      <div class="fade-in-left">
        <h1
          class="text-gradient-emerald"
          style="
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          ‚ö° Security Dashboard
        </h1>
        <p style="color: #94a3b8; margin-top: 0.5rem">
          Monitor your organization's security posture and campaigns.
        </p>
      </div>
    </div>

    <div class="dashboard-grid">
      <div class="stat-card hover-lift stagger-item">
        <div
          style="
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
          "
        >
          üë•
        </div>
        <div class="stat-number"><%= stats.totalUsers || 0 %></div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card hover-lift stagger-item">
        <div
          style="
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
          "
        >
          üéØ
        </div>
        <div
          class="stat-number"
          style="
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          <%= stats.activeCampaigns || 0 %>
        </div>
        <div class="stat-label">Active Campaigns</div>
      </div>
      <div class="stat-card hover-lift stagger-item">
        <div
          style="
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
          "
        >
          üìä
        </div>
        <div class="stat-number"><%= stats.clickRate || 0 %>%</div>
        <div class="stat-label">Click Rate</div>
      </div>
      <div class="stat-card hover-lift stagger-item">
        <div
          style="
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
          "
        >
          üìß
        </div>
        <div
          class="stat-number"
          style="
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
          "
        >
          <%= stats.totalTemplates || 0 %>
        </div>
        <div class="stat-label">Templates</div>
      </div>
    </div>

    <div class="glass-card card-emerald fade-in-up">
      <div style="display: flex; align-items: center; margin-bottom: 2rem">
        <div
          style="
            font-size: 1.5rem;
            margin-right: 1rem;
            color: var(--primary-emerald);
          "
        >
          üìà
        </div>
        <h2 style="margin: 0; color: var(--light-emerald)">
          Campaign Performance
        </h2>
      </div>
      <div class="chart-container">
        <canvas id="campaignChart"></canvas>
      </div>
    </div>

    <div class="glass-card card-emerald fade-in-up">
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 2rem;
        "
      >
        <div style="display: flex; align-items: center">
          <div
            style="
              font-size: 1.5rem;
              margin-right: 1rem;
              color: var(--primary-emerald);
            "
          >
            üõ°Ô∏è
          </div>
          <h2 style="margin: 0; color: var(--light-emerald)">Security Tools</h2>
        </div>
      </div>
      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1rem;
        "
      >
        <a href="/url-scanner" style="text-decoration: none">
          <div
            class="stat-card hover-lift"
            style="
              text-align: left;
              cursor: pointer;
              border-left: 4px solid var(--primary-emerald);
            "
          >
            <div style="font-size: 2rem; margin-bottom: 0.5rem">üîç</div>
            <div
              style="
                color: #f8fafc;
                font-weight: 600;
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
              "
            >
              URL Scanner
            </div>
            <div style="color: #94a3b8; font-size: 0.85rem">
              Scan URLs for threats
            </div>
          </div>
        </a>
        <a href="/breach-search" style="text-decoration: none">
          <div
            class="stat-card hover-lift"
            style="
              text-align: left;
              cursor: pointer;
              border-left: 4px solid var(--accent-gold);
            "
          >
            <div style="font-size: 2rem; margin-bottom: 0.5rem">üîì</div>
            <div
              style="
                color: #f8fafc;
                font-weight: 600;
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
              "
            >
              Breach Search
            </div>
            <div style="color: #94a3b8; font-size: 0.85rem">
              Check data breaches
            </div>
          </div>
        </a>
        <a href="/darkweb-monitor" style="text-decoration: none">
          <div
            class="stat-card hover-lift"
            style="
              text-align: left;
              cursor: pointer;
              border-left: 4px solid var(--danger-red, #f43f5e);
            "
          >
            <div style="font-size: 2rem; margin-bottom: 0.5rem">üïµÔ∏è</div>
            <div
              style="
                color: #f8fafc;
                font-weight: 600;
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
              "
            >
              Dark Web Monitor
            </div>
            <div style="color: #94a3b8; font-size: 0.85rem">
              Monitor dark web leaks
            </div>
          </div>
        </a>
        <a href="/phone-validator" style="text-decoration: none">
          <div
            class="stat-card hover-lift"
            style="
              text-align: left;
              cursor: pointer;
              border-left: 4px solid var(--danger-red, #f43f5e);
            "
          >
            <div style="font-size: 2rem; margin-bottom: 0.5rem">üïµÔ∏è</div>
            <div
              style="
                color: #f8fafc;
                font-weight: 600;
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
              "
            >
              Phone Validator
            </div>
            <div style="color: #94a3b8; font-size: 0.85rem">
              Monitors phone address and potential scam
            </div>
          </div>
        </a>
      </div>
    </div>

    <div class="glass-card card-gold fade-in-up">
      <div style="display: flex; align-items: center; margin-bottom: 2rem">
        <div
          style="
            font-size: 1.5rem;
            margin-right: 1rem;
            color: var(--accent-gold);
          "
        >
          ‚ö°
        </div>
        <h2 style="margin: 0; color: var(--light-gold)">Recent Activity</h2>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Campaign</th>
              <th>Status</th>
              <th>Sent</th>
              <th>Clicked</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% if (recentCampaigns && recentCampaigns.length > 0) { %> <%
            recentCampaigns.forEach(campaign => { %>
            <tr>
              <td><%= campaign.name %></td>
              <td>
                <span class="badge badge-<%= campaign.status.toLowerCase() %>"
                  ><%= campaign.status %></span
                >
              </td>
              <td><%= campaign.sent %></td>
              <td><%= campaign.clicked %></td>
              <td><%= new Date(campaign.createdAt).toLocaleDateString() %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="5" style="text-align: center; color: #94a3b8">
                No campaigns yet
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<button
  class="floating-action"
  onclick="window.location.href='/campaigns/new'"
  title="New Campaign"
>
  +
</button>

<script>
  // Sidebar Toggle
  const toggleBtn = document.getElementById("sidebarToggle");
  const sidebar = document.querySelector(".sidebar");
  const mainContent = document.querySelector(".main-content");

  if (toggleBtn) {
    toggleBtn.addEventListener("click", function () {
      this.classList.toggle("active");
      if (sidebar) sidebar.classList.toggle("collapsed");
      if (mainContent) mainContent.classList.toggle("expanded");
    });
  }

  // Chart.js configuration
  setTimeout(() => {
    const ctx = document.getElementById("campaignChart").getContext("2d");
    const isLightTheme =
      document.documentElement.getAttribute("data-theme") === "light";

    // Create Gradient
    let gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, "rgba(139, 92, 246, 0.5)"); // Violet
    gradient.addColorStop(1, "rgba(139, 92, 246, 0.0)");

    const campaignChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
        datasets: [
          {
            label: "Click Rate %",
            data: [12, 19, 15, 25, 22, 18],
            borderColor: "#8b5cf6", // Violet
            backgroundColor: gradient,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: "#06b6d4", // Cyan dots
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#06b6d4",
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: isLightTheme ? "#0f172a" : "#cbd5e1" },
          },
        },
        scales: {
          y: {
            ticks: { color: isLightTheme ? "#0f172a" : "#94a3b8" },
            grid: {
              color: isLightTheme
                ? "rgba(0, 0, 0, 0.05)"
                : "rgba(255, 255, 255, 0.05)",
            },
          },
          x: {
            ticks: { color: isLightTheme ? "#0f172a" : "#94a3b8" },
            grid: {
              color: isLightTheme
                ? "rgba(0, 0, 0, 0.05)"
                : "rgba(255, 255, 255, 0.05)",
            },
          },
        },
      },
    });
  }, 100);
</script>

<%- include('partials/footer') %>
